# Система фильтрации вопросов по юридической тематике

## Обзор

Реализована система фильтрации вопросов, которая принимает только юридические вопросы и отклоняет все остальные с информативным сообщением.

## Файлы изменений

### 1. `modules/question_filter.py` (новый)
- Основной модуль фильтрации вопросов
- Содержит класс `QuestionFilter` с алгоритмом анализа
- Более 150 ключевых слов с весовыми коэффициентами
- 27 паттернов для юридических вопросов
- 33 паттерна для исключения неюридических вопросов
- Бонусная система для комбинаций слов
- Минимальный порог: 0.15 (15% уверенности)

### 2. `modules/bot_handler.py` (изменен)
- Добавлен импорт фильтра: `from .question_filter import is_legal_question, get_rejection_message`
- Интеграция фильтра в метод `handle_question()` в самом начале обработки
- Логирование принятых и отклоненных вопросов

## Алгоритм фильтрации

### Категории анализа:
1. **Ключевые слова** (150+ слов с весами 0.3-1.0)
2. **Юридические паттерны** (27 регулярных выражений)
3. **Юридические темы** (30+ отраслей права)
4. **Юридические действия** (40+ типичных действий)
5. **Юридические субъекты** (60+ участников процесса)

### Бонусная система:
- Беларусь + юридические термины: +0.2
- Вопросительные слова + юридические термины: +0.15
- Документы + процедуры: +0.1
- Права + обязанности: +0.1
- Ответственность + нарушения: +0.1

### Исключающие паттерны:
- Кулинарные рецепты
- Медицинские вопросы
- Технические проблемы
- Погода и развлечения
- Спорт и игры

## Результаты тестирования

**Финальная статистика:**
- ✅ **90% юридических вопросов проходят фильтр** (18/20)
- ❌ **100% неюридических вопросов отклоняются** (20/20)

**Примеры принятых вопросов:**
- "Как подать иск в суд в Беларуси?" ✅
- "Какие документы нужны для развода в РБ?" ✅
- "Как оформить трудовой договор по ТК РБ?" ✅
- "Какая ответственность за нарушение договора?" ✅

**Примеры отклоненных вопросов:**
- "Как приготовить борщ?" ❌
- "Какая сегодня погода?" ❌
- "Как установить Windows?" ❌
- "Симптомы гриппа" ❌

## Сообщение об отклонении

Пользователи получают подробное сообщение с:
- Объяснением специализации бота
- Примерами правильных юридических вопросов
- Списком того, что бот НЕ может делать
- Советами по переформулированию вопросов

## Логирование

Все операции фильтрации логируются с деталями:
```
✅ ФИЛЬТР: Принят юридический вопрос от пользователя 12345 (оценка: 0.431): Ключевые слова: иск, суд, беларуси
❌ ФИЛЬТР: Отклонен неюридический вопрос от пользователя 12345 (оценка: 0.000): Юридические признаки не найдены
```

## Настройка

Для изменения чувствительности фильтра:
- Изменить `min_legal_score` в классе `QuestionFilter`
- Добавить новые ключевые слова в `_get_legal_keywords()`
- Добавить новые паттерны в `_get_legal_patterns()`

## Использование

Фильтр автоматически активируется при получении любого текстового сообщения в боте. Неюридические вопросы отклоняются до обращения к базе знаний или OpenAI, что экономит ресурсы.

## Преимущества

1. **Экономия ресурсов** - неюридические вопросы не обрабатываются
2. **Четкая специализация** - пользователи понимают назначение бота
3. **Образовательная функция** - примеры правильных вопросов
4. **Высокая точность** - 90% точность для юридических вопросов
5. **Гибкость** - легко настраивается и расширяется 